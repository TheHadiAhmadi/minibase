{"version":3,"file":"_server.ts-5d7d1cfc.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/run/_id_/_server.ts.js"],"sourcesContent":["import { VM } from \"vm2\";\nimport { g as getCode } from \"../../../../chunks/index3.js\";\nfunction DB(collection) {\n  let _data = [];\n  return {\n    insert(data2) {\n      const value = { value: data2, id: crypto.randomUUID() };\n      _data.push(value);\n      return value;\n    },\n    remove(id) {\n      _data = _data.filter((data2) => data2.id !== id);\n      return true;\n    },\n    update(id, data2) {\n      _data = _data.map((d) => {\n        if (d.id == id)\n          return data2;\n        return d;\n      });\n      return { id, value: data2 };\n    },\n    get(id) {\n      return _data.find((data2) => data2.id === id);\n    },\n    find(filter = {}, options = {}) {\n      const take = options.take ?? -1;\n      const skip = options.skip ?? 0;\n      const result = _data.filter((data2) => {\n        Object.entries(filter).map(([key, value]) => {\n          if (data2[key] !== value) {\n            return false;\n          }\n        });\n        return true;\n      });\n      if (take === -1)\n        return result.slice(skip);\n      if (take > result.length)\n        return result.slice(skip);\n      return result.slice(skip, skip + take);\n    }\n  };\n}\nasync function handle({ request, params }) {\n  const id = params.id;\n  console.log(\"New Request -------------- \" + id);\n  const { code } = await getCode({ name: id });\n  if (!code) {\n    return new Response(\n      JSON.stringify({ message: \"Function doesn't exists\" }),\n      { status: 404 }\n    );\n  }\n  const input = code + \"\\nhandle(__request);\";\n  try {\n    const vm = new VM({ timeout: 5e3 });\n    vm.freeze(request, \"__request\");\n    vm.freeze(fetch, \"fetch\");\n    vm.freeze(Headers, \"Headers\");\n    vm.freeze(Response, \"Response\");\n    vm.freeze(DB, \"DB\");\n    const output = await vm.run(input);\n    console.log(output);\n    if (output instanceof Response) {\n      return output;\n    } else if (typeof output === \"object\") {\n      const headers = output.headers ?? {};\n      const status = output.status ?? 200;\n      const body = output.body;\n      const bodyInit = typeof body === \"object\" ? JSON.stringify(body) : body;\n      return new Response(bodyInit, {\n        status,\n        headers\n      });\n    } else if (typeof output === \"string\" || typeof output === \"number\") {\n      return new Response(output.toString(), { status: 200 });\n    }\n  } catch (err) {\n    console.log(err);\n    return new Response(\"Internal Server Error\", { status: 500 });\n  }\n}\nfunction GET(event) {\n  return handle(event);\n}\nfunction POST(event) {\n  return handle(event);\n}\nfunction PUT(event) {\n  return handle(event);\n}\nfunction DELETE(event) {\n  return handle(event);\n}\nexport {\n  DELETE,\n  GET,\n  POST,\n  PUT\n};\n"],"names":[],"mappings":"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"}